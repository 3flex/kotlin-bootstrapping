name: Kotlin Bootstrapping

on: workflow_dispatch

jobs:
  bootstrap:
    runs-on: ubuntu-20.04
    steps:
    - name: Set up environment
      run: sudo apt install openjdk-8-jdk ant ant-contrib libjline2-java libjarjar-java libnative-platform-java

    - name: Configure Java
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '8'

    - name: Fetch sources
      uses: actions/checkout@v4

    - uses: actions/cache@v4
      with:
        path: |
          build
          dependencies
        key: ${{ hashFiles('Makefile') }}

    - name: Checkout IntelliJ 133
      uses: actions/checkout@v4
      with:
        repository: JetBrains/intellij-community
        path: intellij-community
        filter: tree:0
        fetch-tags: true
        fetch-depth: 0

    - name: Checkout Kotlin 
      uses: actions/checkout@v4
      with:
        repository: JetBrains/kotlin
        path: kotlin
        filter: tree:0
        fetch-tags: true
        fetch-depth: 0

    - run: make

    - run: make build/kotlin-1.1.0

    - name: Report
      run: tree -s -h --du build/kotlin*
