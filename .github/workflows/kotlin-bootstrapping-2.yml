name: Kotlin Bootstrapping

on: workflow_dispatch

jobs:
  bootstrap:
    runs-on: ubuntu-20.04
    steps:
    - name: Set up environment
      run: sudo apt install openjdk-8-jdk ant ant-contrib libjline2-java libjarjar-java libnative-platform-java

    - name: Configure Java
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '8'

    - name: Fetch sources
      run: |
        git clone https://github.com/ebourg/kotlin-bootstrapping .

    - run: make init

    - name: Checkout IntelliJ 133
      uses: actions/checkout@v4
      with:
        repository: JetBrains/intellij-community
        path: intellij-community
        ref: 133

    - name: IntelliJ 133
      run: make build/intellij-community-133

    - name: Checkout Kotlin 
      uses: actions/checkout@v4
      with:
        repository: JetBrains/kotlin
        path: kotlin
        ref: 0.6.786

    - name: Kotlin 0.6.786
      run: make build/kotlin-0.6.786

    - name: Report
      run: tree -s -h --du build/kotlin*
