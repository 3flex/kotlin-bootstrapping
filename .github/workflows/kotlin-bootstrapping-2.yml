name: Kotlin Bootstrapping

on: workflow_dispatch

jobs:
  bootstrap:
    runs-on: ubuntu-20.04
    steps:
    - name: Set up environment
      run: sudo apt install openjdk-8-jdk ant ant-contrib libjline2-java libjarjar-java libnative-platform-java

    - name: Configure Java
      run: |
        sudo update-java-alternatives --set java-1.8.0-openjdk-amd64
        java -version

    - name: Fetch sources
      run: |
        git clone https://github.com/ebourg/kotlin-bootstrapping .
        make kotlin

    - name: Checkout IntelliJ 133
      uses: actions/checkout@v4
      with:
        repository: JetBrains/intellij-community
        ref: 133

    - name: IntelliJ 133
      run: make build/intellij-community-133

    - name: Checkout Kotlin 
      uses: actions/checkout@v4
      with:
        repository: JetBrains/kotlin
        ref: 0.6.786

    - name: Kotlin 0.6.786
      run: make build/kotlin-0.6.786

    - name: Report
      run: tree -s -h --du build/kotlin*
